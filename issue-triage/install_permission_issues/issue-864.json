{"assignees":[],"author":{"id":"MDQ6VXNlcjE3MDIwNzA1","is_bot":false,"login":"Peetee06","name":"Peter Trost"},"body":"**Before creating a bug report please make check the following**\n\n- [x] You have read our [FAQ](https://fvm.app/docs/guides/faq)\n- [x] If you have used flutter. Please install correctly, run `pub cache repair`. Close the terminal and try again.\n- [x] If you are on Windows. Make sure you are running the terminal as `administrator` or with `developer` permissions.\n- [x] Run `fvm doctor` if possible and add the output to the issue.\n\n**Describe the bug**\nWhen installing fvm via the latest `install.sh` from today, it fails when ran inside of the [universal image](https://github.com/openai/codex-universal) used by OpenAI Codex, because setup commands are run as root user there.\n\n**To Reproduce**\nSteps to reproduce the behavior:\n\n1. [Create a new](https://chatgpt.com/codex/settings/environment/create) or edit an existing Codex environment on a Flutter repository\n2. Set this **setup script**:\n```bash\n#!/usr/bin/env bash\n\nset -e\n\n# Install fvm and Flutter\ncurl -fsSL https://fvm.app/install.sh | bash\nfvm install -s\n\n# Link commands\nln -sf \"$(fvm flutter --which)\" /usr/local/bin/flutter\nln -sf \"$(dirname \"$(fvm flutter --which)\")/dart\" /usr/local/bin/dart\n```\n4. Click on \"Connect interactive terminal\" and wait for it to proceed with running the setup script\n5. See error \"This script should not be run as root. Please run as a normal user.\"\n\n**Expected behavior**\nI should be able to install fvm even as a root user for these use cases. It worked perfectly fine yesterday and I was able to successfully let Codex make changes to my Flutter project using fvm.\n\n**Additional context**\nI tried setting up a dedicated user just to install fvm but run into one issue after another trying to make it work. Here's the latest script that still fails to install fvm in the Codex environment:\n\n```bash\n#!/usr/bin/env bash\nset -e\n\necho \"üîß Creating temporary non-root user to install FVM...\"\nuseradd -m -s /bin/bash fvmuser\nexport HOME=/home/fvmuser\n\necho \"üì• Installing FVM as non-root user (clean bash)‚Ä¶\"\nsu - fvmuser -s /bin/bash -c \\\n  \"bash --noprofile --norc -c \\\"curl -fsSL https://fvm.app/install.sh | bash\\\"\"\n\necho \"üì¶ Installing Flutter SDK via FVM‚Ä¶\"\nsu - fvmuser -s /bin/bash -c \\\n  \"bash --noprofile --norc -c \\\"~/.fvm_flutter/bin/fvm install -s\\\"\"\n\necho \"üîÅ Copying FVM installation to /opt/fvm for root use‚Ä¶\"\nmkdir -p /opt/fvm\ncp -r /home/fvmuser/.fvm_flutter /opt/fvm\n\necho \"üîó Linking FVM, Flutter, and Dart to /usr/local/bin‚Ä¶\"\nln -sf /opt/fvm/.fvm_flutter/bin/fvm   /usr/local/bin/fvm\nln -sf \"$(/opt/fvm/.fvm_flutter/bin/fvm flutter --which)\" /usr/local/bin/flutter\nln -sf \"$(dirname $(/opt/fvm/.fvm_flutter/bin/fvm flutter --which))/dart\" /usr/local/bin/dart\n\necho \"‚úÖ FVM, Flutter, and Dart are now globally available under root.\"\n```\n\nI'm switching to directly installing Flutter now, but that won't be as robust, because we're managing the Flutter version with fvm in our project..","closedAt":"2025-06-09T00:06:57Z","comments":[{"id":"IC_kwDOCkCuKM6v93G1","author":{"login":"romain-pattyn"},"authorAssociation":"NONE","body":"Same here! Critical bug!","createdAt":"2025-06-07T09:23:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/leoafarias/fvm/issues/864#issuecomment-2952229301","viewerDidAuthor":false},{"id":"IC_kwDOCkCuKM6v-eWE","author":{"login":"romain-pattyn"},"authorAssociation":"NONE","body":"Ended up using dart pub. It's weird to install flutter just to install fvm, but we don't have the choice as our entire system uses fvm flutter in a hardcoded way.\n\n```docker\n# Install Flutter SDK to get dart command\nRUN git clone --branch stable https://github.com/flutter/flutter.git /usr/local/flutter\nENV PATH=\"/usr/local/flutter/bin:/usr/local/flutter/bin/cache/dart-sdk/bin:${PATH}\"\n\n# Install FVM\nRUN dart pub global activate fvm\n```","createdAt":"2025-06-07T11:45:01Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":2}}],"url":"https://github.com/leoafarias/fvm/issues/864#issuecomment-2952390020","viewerDidAuthor":false},{"id":"IC_kwDOCkCuKM6v-hNQ","author":{"login":"Peetee06"},"authorAssociation":"NONE","body":"An alternative I used now was downloading the previous `install.sh` that allowed root user install:\n\n```bash\n# Use a specific legacy installer (commit af7905378b2863c8b29f1e031e0f1b09abaee66e)\n# to avoid the root-user check added in newer releases\nINSTALL_SCRIPT_URL=\"https://raw.githubusercontent.com/leoafarias/fvm/af7905378b2863c8b29f1e031e0f1b09abaee66e/scripts/install.sh\"\n\necho \"üîß Installing FVM (Flutter Version Manager) via legacy installer...\"\ncurl -fsSL \"$INSTALL_SCRIPT_URL\" | bash\n```","createdAt":"2025-06-07T11:57:32Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/leoafarias/fvm/issues/864#issuecomment-2952401744","viewerDidAuthor":false},{"id":"IC_kwDOCkCuKM6v_P5l","author":{"login":"leoafarias"},"authorAssociation":"OWNER","body":"Sorry the script should not have been deployed yet.. fixing it ","createdAt":"2025-06-07T14:44:34Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"HEART","users":{"totalCount":1}}],"url":"https://github.com/leoafarias/fvm/issues/864#issuecomment-2952592997","viewerDidAuthor":true},{"id":"IC_kwDOCkCuKM6wC7Y0","author":{"login":"Peetee06"},"authorAssociation":"NONE","body":"Just saw the logic to allow non-root in container environments! Really nice work on that! üöÄ","createdAt":"2025-06-08T05:04:28Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/leoafarias/fvm/issues/864#issuecomment-2953557556","viewerDidAuthor":false}],"createdAt":"2025-06-07T07:00:29Z","labels":[{"id":"MDU6TGFiZWwxMjQzODI3Nzc0","name":"bug","description":"Something isn't working","color":"d73a4a"}],"number":864,"state":"CLOSED","title":"[BUG] install.sh now fails in docker images that run as root","updatedAt":"2025-06-09T00:06:57Z","url":"https://github.com/leoafarias/fvm/issues/864"}
